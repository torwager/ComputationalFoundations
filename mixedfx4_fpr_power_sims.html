

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Mixed effects simulations &#8212; Computational Foundations for Neuroscience</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'mixedfx4_fpr_power_sims';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Active inference" href="activeinference_smith.html" />
    <link rel="prev" title="Mixed effects algebra" href="mixedfx3_algebra.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/yellow_flower_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/yellow_flower_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Computational foundations for Neuroscience
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preliminary background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="startingresources.html">Some resources</a></li>

<li class="toctree-l1"><a class="reference internal" href="topicmenu.html">A menu of topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="basicdistancecovcorr.html">Fundamentals of distance, covariance, and correlation</a></li>
<li class="toctree-l1"><a class="reference internal" href="statsinmatlab.html">Stats in Matlab</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">General linear model (GLM)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="glm1.html">General Linear Model (GLM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="glm2_param_inference.html">Parametric inference in the GLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="glm3_ashardataset.html">Sample dataset and analysis 1: Ashar 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="glm4_parameterizingglm.html">Parameterizing models in a GLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="glm5_weightedleastsquares.html">Generalized Least Squares (GLS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="glm6_matlab_glm_answerkey.html">A hand-coded GLM in MATLAB</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mixed effects</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="mixedfx1_intro.html">Mixed effects: Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixedfx2_examples.html">Mixed effects: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixedfx3_algebra.html">Mixed effects algebra</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Mixed effects simulations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bayesian models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="activeinference_smith.html">Active inference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reinforcement Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="reinforcementlearning.html">Reinforcement Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Neural networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="recurrentneuralnets.html">Recurrent Neural networks</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/torwager/ComputationalFoundations" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/torwager/ComputationalFoundations/edit/master/docs/mixedfx4_fpr_power_sims.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/torwager/ComputationalFoundations/issues/new?title=Issue%20on%20page%20%2Fmixedfx4_fpr_power_sims.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/mixedfx4_fpr_power_sims.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mixed effects simulations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-simulation">Why simulation?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-variance-and-parameter-recovery">Bias, variance, and parameter recovery</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#power-and-false-positive-rates-fpr">Power and false positive rates (FPR)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-performance-in-simulations">Estimating performance in simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turning-our-simulation-code-into-bias-and-variance-simulations">Turning our simulation code into bias and variance simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#power-and-fpr-simulations">Power and FPR Simulations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-models">Comparing Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activity">Activity:</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="mixed-effects-simulations">
<h1>Mixed effects simulations<a class="headerlink" href="#mixed-effects-simulations" title="Permalink to this heading">#</a></h1>
<section id="why-simulation">
<h2>Why simulation?<a class="headerlink" href="#why-simulation" title="Permalink to this heading">#</a></h2>
<p>If you create a new model or code, how do you know that your equations and calculations are correct? Moreover, most models use statistics that make assumptions and often hold for large-sample approximations. They may or may not perform poorly under some data conditions.</p>
<p>How do you know whether a model and/or code works as expected?</p>
<p>Simulations are an important way to validate a model and/or code implementation.</p>
<p>They are common in computational process models and dynamic models where it’s not always clear whether parameters are identified and how the system will respond to various types of inputs. But they are also very useful with more complex forms of linear models.</p>
<p>Simulations are the <strong>only</strong> way to test a model’s ability to perform as expected, because only in simulations do you know the ground truth.</p>
</section>
<section id="bias-variance-and-parameter-recovery">
<h2>Bias, variance, and parameter recovery<a class="headerlink" href="#bias-variance-and-parameter-recovery" title="Permalink to this heading">#</a></h2>
<p>Some important things to test are:</p>
<ul class="simple">
<li><p><strong>Bias</strong>: Does a model recover the true parameter estimates on average?  That is, is <span class="math notranslate nohighlight">\(E(\hat\beta)=\beta\)</span>?</p></li>
<li><p><strong>Variance</strong>: How precise are the model’s estimates across replications? Precision is the reciprocal (inverse) of variance, so we are interested in comparing <span class="math notranslate nohighlight">\(E(var(\hat\beta))\)</span> across models. Models with lower average variance have lower expected variance and are preferred.</p></li>
</ul>
<p>These quantities are central to <strong>parameter recovery</strong>, the ability of a model to accurately estimate a set of ground truth parameters on average. For example, a model’s <strong>identifiability</strong> refers to the ability to uniquely estimate parameters based on the data. A model is identifiable if no two different parameter values or sets of parameter values result in the same predicted values, or are otherwise equally likely given the data.</p>
<ul class="simple">
<li><p>A <strong>non-identified</strong> model will have infinite variance.  (In simulations, this will manifest as very large average variance estimates, or errors such as “Matrix cannot be inverted” in some models).</p></li>
<li><p>Bias and variance trade off: Models that produce unbiased estimates are often subject to high variance, particularly when many combinations of parameter estimates can yield similar model fits and likelihoods. e.g., if a model has highly correlated (but identifiable) parameters, it is unbiased but high-variance. If a model under-estimates a true parameter estimate, but does so very consistently across samples, it is biased but low-variance.</p></li>
</ul>
<p><img alt="bias and variance" src="_images/bias_variance_dartboard.png" /></p>
</section>
<section id="power-and-false-positive-rates-fpr">
<h2>Power and false positive rates (FPR)<a class="headerlink" href="#power-and-false-positive-rates-fpr" title="Permalink to this heading">#</a></h2>
<p>In the context of inference, power and FPR are arguably the most important aspects of a model’s performance to test.</p>
<ul class="simple">
<li><p><strong>Power</strong> is the model’s <strong>sensitivity</strong> to true effects, <span class="math notranslate nohighlight">\(P(reject | \beta \neq 0)\)</span>. It is defined in classical test theory as <span class="math notranslate nohighlight">\( 1 - \beta \)</span>, where <span class="math notranslate nohighlight">\(\beta\)</span> is the Type II error rate or “miss” rate. (This is NOT the same <span class="math notranslate nohighlight">\(\beta\)</span> as in GLM!)</p></li>
<li><p><strong>FPR</strong> is the model’s likelihood of generating a falsely significant test of a parameter (or combination) if the true value is 0, <span class="math notranslate nohighlight">\(P(reject | \beta = 0)\)</span>, referred to as <span class="math notranslate nohighlight">\(\alpha\)</span> in test theory. As we normally specify an acceptable <span class="math notranslate nohighlight">\(\alpha\)</span> in an inferential test (e.g., P &lt; 0.05), we’d like to know that a model’s observed <span class="math notranslate nohighlight">\(\alpha\)</span> is consistent with our assumptions.  This is equivalent to 1 - <strong>specificity</strong>. This is related to <strong>coverage</strong>, how likely it is that the true parameter value lies within the estimated confidence interval (or credible interval, in a Bayesian context). For example, we’d like to know that a 95% confidence interval actually covers the true parameter value 95% of the time.</p></li>
</ul>
<p>Power is sensitive to the true <strong>effect size</strong> and sample size, and so are often simulated across a range of these. FPR shouldn’t be sensitive to these, but some tests may perform differently with (e.g., small samples).</p>
<p>Like bias and variance, power and FPR trade off. A liberal test will nearly always yield a significant result, but at a cost in high FPR. In the extreme, all tests are significant, and power = 1, FPR = 0.  A conservative test will rarely yield a significant result, but FPR will also be low. In the extreme, no tests are significant, and power = 0, FPR = 1.  These extreme points define the anchors of the <strong>Receiver Operating Characteristic (ROC)</strong> curve. The ROC curve describes the sensitivity and specificity at all possible threshold (cutoff) values for a positive result. In an ROC curve, a model with chance performance yields a straight line between the anchors. The better a model is at making accurate decisions (for whatever reason, e.g., with larger true effects), the more the curve will bend, yielding high power at low FPR.</p>
<p><img alt="ROC" src="_images/roc_examples.png" /></p>
<p>The images above are a simplified example in which there is an underlying test statistic (e.g., beta, b), and we simply vary the threshold for when we call b significant. In a full simulation, this might be a t-statistic thresholded at varying <span class="math notranslate nohighlight">\(\alpha\)</span> levels. The insensitive model has identically distributed test statistics (here, b) whether there is an underlying signal or not.  The sensitive test has a distribution centered on 0 (no average effect) in the null-hypothesis case (green below), and centered on 2 (an effect size of 2 standard errors) in the alternative-hypothesis case, and so is informative.</p>
<p><img alt="ROC" src="_images/roc_examples_histograms.png" /></p>
<p>Matlab code for this example is available <a class="reference download internal" download="" href="_downloads/5052f19ac0d783547030f86fef09bba9/simple_ROC_demo.mlx"><span class="xref download myst">here</span></a>.</p>
</section>
<section id="estimating-performance-in-simulations">
<h2>Estimating performance in simulations<a class="headerlink" href="#estimating-performance-in-simulations" title="Permalink to this heading">#</a></h2>
<p>The basic steps involved in a parameter recovery study are as follows:</p>
<p><strong>Simulation</strong>: Create a “generative model” or “forward model” with a known set of parameters to generate simulated data. These parameters are typically referred to as the “true” parameters. The data structure usually matches the structure of the model, but the model’s performance under different generative models can be tested as well. For example, linear models assume homoscedastic and normally distributed within-person error variance (<span class="math notranslate nohighlight">\(V\)</span>). (LMER makes both these assumptions). One could simulate cases in which these assumptions are violated, or when there are unmodeled effects.</p>
<p><strong>Estimation</strong>: Fit the same computational model to this simulated data to estimate the model parameters.</p>
<p><strong>Comparison</strong>: Compare the estimated parameters to the original “true” parameters that were used to generate the data.</p>
<ul class="simple">
<li><p><strong>Bias</strong> is defined as the mean deviation between estimated and true model parameters, i.e.,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
bias_{\hat\beta} = \frac{1}{t} \sum_{i=1}^{t} (\hat\beta_i - \beta_{true,i})
\]</div>
<p>for t iterations (usually 10,000 for publication-quality simulations). In each iteration, an independent sample (i.e., with all observations) is drawn from the generative model.</p>
<ul class="simple">
<li><p><strong>Variance</strong> is defined as the squared deviation of model parameter estimates across iterations mean deviation between estimated and true model parameters, i.e.,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
Var(\hat\beta) = \frac{1}{T} \sum_{t=1}^{T} (\hat\beta_{t} - \bar{\hat\beta_{t}})^2
\]</div>
<ul class="simple">
<li><p><strong>Power</strong> is defined as <span class="math notranslate nohighlight">\(P(P_\beta &lt; \alpha | \beta \neq 0)\)</span>, i.e.,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
Power = \frac{1}{T} \sum_{t=1}^{T} (P_{\beta, t} &lt; 0.05 | \beta_{true} \neq 0)
\]</div>
<ul class="simple">
<li><p><strong>FPR</strong> is defined as <span class="math notranslate nohighlight">\(P(P_\beta &lt; \alpha | \beta = 0)\)</span>, i.e.,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
FPR = \frac{1}{T} \sum_{t=1}^{T} (P_{\beta, t} &lt; 0.05 | \beta_{true} = 0)
\]</div>
<p>Some nuance is required when thinking about what the “null hypothesis” conditions are. For example, the <strong>global null</strong> is one in which all true parameters are 0. But we could have a situation in which some parameters have non-zero values, and others are 0.</p>
<ul class="simple">
<li><p>If a parameter with a 0 value is correlated with one with a non-zero value, will its FPR increase?</p></li>
<li><p>If the average <span class="math notranslate nohighlight">\(\beta = 0\)</span> for one parameter, but its variance is non-zero across participants in a mixed effects setting, will its FPR increase?</p></li>
</ul>
</section>
<section id="turning-our-simulation-code-into-bias-and-variance-simulations">
<h2>Turning our simulation code into bias and variance simulations<a class="headerlink" href="#turning-our-simulation-code-into-bias-and-variance-simulations" title="Permalink to this heading">#</a></h2>
<p><a class="reference internal" href="mixedfx3_algebra.html"><span class="doc std std-doc">Previously</span></a>, we created a function to generate data given a simple mixed effects model structure and parameters.  The Matlab example is in the function file <a class="reference download internal" download="" href="_downloads/3a7d08def1a92335246a347fe2793074/sim_generate_mixedfx_data1.mlx"><span class="xref download myst">sim_generate_mixedfx_data1.mlx</span></a>.</p>
<p>We’ll use that to simulate bias and variance across many iterations.</p>
<div style="border: 2px solid #D4D4D4; padding: 10px; margin: 10px; background-color: #F9F9F9; box-shadow: 5px 5px 5px #aaa;">
Activity: Write a script that uses this function (or comparable Python/R version) to generate 500 datasets (iterations). Use these to assess the bias and variance of matlab's *fitlme*. Your script should return a table of bias and variance for each parameter.
<p>Now do the same for CANlab’s igls.m and compare them.</p>
</div>
<p><a class="reference download internal" download="" href="_downloads/4b9e17bfed384a80d5a7c4dfba6872c4/mixedfx_sims_2_fitlme.mlx"><span class="xref download myst">mixedfx_sims_2_fitlme.mlx</span></a>
<a class="reference download internal" download="" href="_downloads/74c7af1d3c7df419d4bd818ec7e601ab/mixedfx_sims_2_igls.mlx"><span class="xref download myst">mixedfx_sims_2_igls.mlx</span></a></p>
</section>
<section id="power-and-fpr-simulations">
<h2>Power and FPR Simulations<a class="headerlink" href="#power-and-fpr-simulations" title="Permalink to this heading">#</a></h2>
<p>Let’s extend our simulations further to simulate power and FPR under different sample sizes.
This is the main way to test whether an inferential model performs as expected.</p>
<p>We’ll need to extend our simulation to generate data under both null-hypothesis and alternative-hypothesis cases.</p>
<p>For this, it’s convenient to turn our previous script, which runs multiple iterations and generates a bias and variance table, into a <strong>function</strong> that generates and fits data for each of a series of iterations, and then collects results (bias, variance, rates of positive findings).</p>
<p>Here are two functions. For convenience, one runs matlab’s fitlme, and one runs glmfit_multilevel.  They are otherwise identical.</p>
<p><a class="reference download internal" download="" href="_downloads/4015450decdee4deebea4c608ec94caa/sim_mixedfx_fpr_power_bias_matlablme.mlx"><span class="xref download myst">sim_mixedfx_fpr_power_bias_matlablme.mlx</span></a>
<a class="reference download internal" download="" href="_downloads/8e37e0e1cfcc0474b6ca23f8d56aac94/sim_mixedfx_fpr_power_bias_glmfitmulti.mlx"><span class="xref download myst">sim_mixedfx_fpr_power_bias_glmfitmulti.mlx</span></a></p>
<p>For a given set of input parameters, <em>sim_mixedfx_fpr_power_bias_matlablme</em> is a wrapper function that generates and fits data for each of a series of iterations, and then collects results (bias, variance, rates of positive findings).  It uses these functions:
<strong>sim_generate_mixedfx_data1</strong> generates a dataset given parameters, and assuming normally distributed errors (this is a separate file we created earlier)
<strong>matlabLMEstats</strong> runs the mixed effects model and collects selected output statistics (this is internal to the function, so no separate file is needed)
<strong>get_sim_stats</strong> collects tables of statistics across iterations (this is internal to the function, so no separate file is needed)</p>
<p>We’ve built up these functions over the last several scripts so you can see how they work and modify them.  They are designed to be modular.
You can:
1 - Run the functions with different inputs, including sample sizes (between/within), variances, fixed effects, regressor types
2 - Copy this script and modify the matlabLMEstats function to return the summary statistics for any mixed effects model you like</p>
<p>If you pass in true fixed effects of 0, you’re generating null-hypothesis data and estimating FPR.  If your true fixed effects are not zero, you’re generating alternative-hypothesis data and estimating power.  The same code does both, depending on the true <span class="math notranslate nohighlight">\(\beta\)</span>s.  Code modularity and reuse are good things!</p>
<p>Using these functions, we can now write a script that uses the functions to run an entire simulation under both null- and alternative-hypothesis conditions and return <strong>power</strong> and <strong>FPR</strong>.  Furthermore, we can do a series of simulations across variables of interest, like <strong>sample size</strong>.</p>
<p><img alt="mixedfx_sims3_code_map" src="_images/mixedfx_sims3_code_map.png" /></p>
<p>Download the live script:
<a class="reference download internal" download="" href="_downloads/817e1f736e6c1e1ad1f2684f3ab9047e/mixedfx_sims_3_power_fpr.mlx"><span class="xref download myst">mixedfx_sims_3_power_fpr.mlx</span></a></p>
<iframe src="matlab_html/mixedfx_sims_3_power_fpr.html" width="120%" height="800px"></iframe>
<section id="questions">
<h3>Questions<a class="headerlink" href="#questions" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>How does fitlme perform in estimating fixed effects across sample size?  a. Are there biases? b. How do variance and power change across sample size?</p></li>
<li><p>How does fitlme perform in estimating random effects across sample size? a. Are there biases? b. How does bias, variance and power change across sample size?</p></li>
</ol>
</section>
</section>
<section id="comparing-models">
<h2>Comparing Models<a class="headerlink" href="#comparing-models" title="Permalink to this heading">#</a></h2>
<p>We can use these scripts with different models to compare the models.
Here is some output comparing fitlme and glmfit_multilevel when all the assumptions hold:</p>
<p><img alt="Comparison" src="_images/fitlme_glmfitmulti_power_fpr_comp.png" /></p>
<p>Do they perform comparably?</p>
<section id="activity">
<h3>Activity:<a class="headerlink" href="#activity" title="Permalink to this heading">#</a></h3>
<p>There are many possible activities!</p>
<ol class="arabic simple">
<li><p>Compare fitlme to R and/or python</p></li>
<li><p>Compare the models when assumptions do not hold – e.g., when error variances differ across individuals.  What is the impact of heteroscedasticity on power and FPR?  Do some models perform better than others?</p></li>
</ol>
<p>Simulate and compare true positive rates (TPR, power) and  false positive rates (FPR) in these interesting cases:</p>
<ul class="simple">
<li><p>mismodeling: ignoring a random effect</p></li>
<li><p>unbalanced data across levels of a predictor</p></li>
<li><p>unequal N within subject</p></li>
<li><p>unequal variances within-subject (the example above)</p></li>
<li><p>experimental design vs. normally-distributed predictors</p></li>
<li><p>non-normally distributed errors</p></li>
<li><p>more vs. fewer irrelevant predictors</p></li>
<li><p>more levels of a predictor (mixed vs ANOVA)</p></li>
<li><p>crossed random effects with more or fewer levels</p></li>
<li><p>random effects of intercept and slope are correlated. This will cause a loss in power due to individual differences in scaling across participants in standard summary statistics approaches. does the lmm handle this without substantial power loss?</p></li>
</ul>
<p>These simulations will give us the ability to really understand how these models perform!</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="mixedfx3_algebra.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Mixed effects algebra</p>
      </div>
    </a>
    <a class="right-next"
       href="activeinference_smith.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Active inference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-simulation">Why simulation?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-variance-and-parameter-recovery">Bias, variance, and parameter recovery</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#power-and-false-positive-rates-fpr">Power and false positive rates (FPR)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-performance-in-simulations">Estimating performance in simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turning-our-simulation-code-into-bias-and-variance-simulations">Turning our simulation code into bias and variance simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#power-and-fpr-simulations">Power and FPR Simulations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions">Questions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-models">Comparing Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activity">Activity:</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tor Wager & others
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>